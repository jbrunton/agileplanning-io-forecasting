<div class="row">
  <div class="large-12 columns">

    <h1>Forecast</h1>

  </div>
</div>
<div class="row">

  <div class="large-4 columns">

    <%= form_tag do %>
        <div class="row">
          <div class="larger-12 columns">
            <label>Start date
              <input type="text" name="start_date" id="start_date" value="<%= @start_date ? @start_date.to_s : nil %>"/>
            </label>
          </div>
        </div>

        <div class="row">
          <div class="larger-12 columns">
            <label>Filter
              <input type="text" name="filter" id="filter" value="<%= params[:filter] ? params[:filter] : nil %>"/>
            </label>
          </div>
        </div>

        <div class="row">
          <div class="large-12 columns">
            <%= submit_tag 'Forecast' %>
          </div>
        </div>
    <% end %>

    <h4>Backlog</h4>
    <% @backlog.each do |epic| %>
        <div class="panel"><%= epic.summary %></div>
    <% end %>

  </div>
  <div class="large-8 columns">

    <% if @forecasts %>
        <table style="width: 100%">
          <tr>
            <th width="30%">Likelihood</th>
            <th width="30%">Time</th>
            <th width="40%">Date</th>
          </tr>
        </table>
          <% @forecasts.each do |record| %>
            <table style="width: 100%">
              <tr class="panel callout">
                <th colspan="4"><%= record[:epic].summary %></th>
              </tr>

              <tr>
                <% record[:forecast].each do |interval| %>
                  <tr>
                    <td width="30%"><%= "#{interval[:likelihood]} %" %></td>
                    <td width="30%"><%= "#{sprintf('%.1f', interval[:actual_time])} days" %></td>
                    <td width="40%"><%= format_datetime(@start_date + interval[:actual_time].days) %></td>
                  </tr>
              <% end %>

              </tr>
            </table>

          <% end %>

    <% end %>
  </div>
</div>